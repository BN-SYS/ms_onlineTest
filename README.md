# 멘사 온라인 테스트 시스템

## [프로토타입 보기](https://bn-sys.github.io/ms_onlineTest/v3)


## 요구사항 요약
기존 멘사코리아 입회테스트 사이트에 회원/비회원 모두 무료로 응시 가능한 3단계 IQ 테스트 기능을 추가 개발한다.<br>
결과 확인 시 2단계 결제 옵션(기본 결과/상세 리포트)을 제공하며, 단계별 문제 은행 기반 랜덤 출제, 응시자 출생년도 정보를 기반으로 연령 보정 채점, 비정상 응시 패턴 차단, 관리자 문제/로그 관리 기능을 포함한다.<br> 
관리자페이지 또한 기존에 만들어져 있는 사이트에 '온라인테스트 관리' 메뉴를 추가 개발한다.

---

## 1. 프로젝트 목적 및 배경

### 기획 배경
- 기존 입회 테스트 외 별도 온라인 체험형 콘텐츠 신설 (테스트 작명 필요 / IQ 사용 금지)
- 멘사 브랜드 기반 온라인 테스트 서비스 제공
- 무료 응시 → 결과 유료화 수익 모델

### 목표
- 신규 유입 확보 및 브랜드 경험 제공
- 응시 데이터 축적 및 분석 기반 마련
- 2단계 결제 구조로 수익성 확보

---

## 2. 사용자 플로우 (전체 구조)

```
[시작]
  ↓
[개인정보 입력] (이름, 출생연도, 이메일, 약관 동의)
  ↓
[1단계 테스트] (N문제, N분 제한)
  ↓
[1단계 검증] (정답률 20% 이상 + 평균 응답시간 30초 이상)
  ↓ 실패 시: 상황에 따라 "정답률이 너무 낮거나 비정상적인 응시 패턴이 감지되었습니다. 문제를 충분히 읽고 신중히 응답해주세요." 메시지 → 해당 단계 처음부터 재시작
  ↓
[2단계 테스트] (N문제, N분 제한)
  ↓
[2단계 검증] (동일 기준)
  ↓
[3단계 테스트] (N문제, N분 제한)
  ↓
[점수 산출] (정답 기반 + 연령 보정)
  ↓
[결제 선택]
  ├─ 기본 결과 (19,900원): 점수 + 백분위 + 발급번호 + 진위확인 코드
  └─ 상세 리포트 (24,900원): 기본 + 표준편차 그래프(Chart.js 라이브러리 활용) + 단계별 분석 + 개선 방향
  ↓
[결과 확인] + 이메일 발송
```

---

## 3. 테스트 구조 상세

### 3-1. 단계별 특징

| 단계 | 문제 수 | 시간 제한 | 측정 영역 | 문제 은행 예시 규모 | 기본점수 | 문제당 배점 |
|------|---------|----------|----------|------------------|-----------|----------|
| 1단계 | 관리자 설정 | 관리자 설정 | 레이븐스 매트릭스 (도형 패턴 인식) | 관리자 설정	N개 | 관리자 설정| (100-기본점수) / 문제수 |
| 2단계 | 관리자 설정 | 관리자 설정 | 수리 연산 능력 | 관리자 설정	N개 | 관리자 설정 |(100-기본점수) / 문제수 |
| 3단계 | 관리자 설정 | 관리자 설정 | 기억력 또는 상식 (웩슬러 요소) | 관리자 설정	N개 | 관리자 설정 |(100-기본점수) / 문제수 |

#### 설정 예시 (관리자에서 조정 가능)
- 1단계: 15문제, 기본점수 40점, 문제당 4점, 제한시간 30분
- 2단계: 5문제, 기본점수 60점, 문제당 8점, 제한시간 10분
- 3단계: 5문제, 기본점수 60점, 문제당 8점, 제한시간 10분

### 3-2. 문제 출제 로직

**문제 은행 구조**
- 각 단계별로 독립적인 문제 은행(pool) 보유
- 예: 1단계 문제 은행 N개 → 응시 시 랜덤 N개 선택
- 사용자마다 다른 문제 조합 출제 
- 🔴 비정상정인 패턴 감지로 인한 단계 재시작시에는 동일문제 출제인지 확인 필요.

**랜덤 처리 규칙**
- **문제 순서**: 랜덤 아님 (문제 은행에서 선택된 순서대로 출제)
- **보기 순서**: 랜덤 (매 응시마다 보기 배열 섞음)
- **보기 개수**: 문제마다 2~8개 유동적 (관리자 설정에 따름)

### 3-3. 검증 로직 (비정상 응시 차단)

**각 단계 완료 후 검증**
- 정답률 N% 미만 → 차단
- 평균 응답시간 N초 미만 → 차단
- 차단 시 메시지: "정답률이 너무 낮거나 비정상적인 응시 패턴이 감지되었습니다. 문제를 충분히 읽고 신중히 응답해주세요."
- 🔴 비정상 응시 감지로 재시작되어도 하나의 응시 로그로 저장 (응시자 정보 유지)

---

## 4. 개인정보 입력 및 동의

### 4-1. 입력 시점
**테스트 시작 전** (문제 풀기 전에 입력 및 동의 먼저)

### 4-2. 입력 항목

**비회원**
- 이름 (텍스트)
- 출생연도 (드롭다운, 1900~현재-5)
- 이메일 (이메일 형식 검증)

**회원**
- 로그인 상태면 아이디 매핑으로 정보 자동 입력
- 수정 불가능하게 비활성화
- 🔴 회원인 경우 이력확인 및 결과확인 지속 제공 여부 확인 필요

### 4-3. 약관 동의 (필수 체크박스)

**동의 조항 예시**
1. 개인정보 수집 및 이용 동의
2. 결과 이메일 발송 동의
3. **"문제 유출 또는 불법 공유 시 법적 조치를 받을 수 있습니다"**
4. **"온라인 테스트는 공식 멘사 입회를 담보하지 않습니다"**

**UI 예시**
```
☑ 위 내용을 모두 확인하였으며 동의합니다 (필수)
```

### 4-4. 자동 저장 정보
- IP 주소 (자동 수집)
- 응시 시작 시간 (타임스탬프)
- 회원 ID (로그인 시)

---

## 5. 점수 산출 로직

### 5-1. 점수 체계 개요
**100점 만점 체계**
- 각 단계별로 독립적인 점수 산출 (최대 100점)
- 종합 점수 = 3단계 점수의 평균
- 연령 보정 적용 (최대 100점 초과 불가)

### 5-2. 단계별 점수 계산 공식
```javascript
// 단계별 점수 계산
단계 점수 = 기본 점수 + (정답 개수 × 문제당 배점) + 연령 보정

// 100점 초과 방지
if (단계 점수 > 100) {
  단계 점수 = 100;
}

// 종합 점수 계산
종합 점수 = (1단계 점수 + 2단계 점수 + 3단계 점수) ÷ 3
```

### 5-3. 점수 계산 예시
**가정 (관리자 설정값)**
- 1단계: 15문제, 기본점수 40점, 문제당 4점, 제한시간 30분
- 2단계: 5문제, 기본점수 60점, 문제당 8점, 제한시간 10분
- 3단계: 5문제, 기본점수 60점, 문제당 8점, 제한시간 10분
- 응시자: 35세 (연령 보정 +4점)

#### 1단계 점수 계산
$$\text{1단계 점수} = 40 + (12 \times 4) + 4 = 92\text{점}$$

- 기본점수: 40점
- 정답 12개 × 4점 = 48점
- 연령 보정: +4점
- **합계: 92점**

#### 2단계 점수 계산
- 정답 4개 × 8점 = 32점
- 연령 보정: +4점
- **합계: 96점**

#### 3단계 점수 계산
$$\text{3단계 점수} = 60 + (3 \times 8) + 4 = 88\text{점}$$

- 기본점수: 60점
- 정답 3개 × 8점 = 24점
- 연령 보정: +4점
- **합계: 88점**

#### 종합 점수 계산
$$\text{종합 점수} = \frac{92 + 96 + 88}{3} = 92\text{점}$$

### 5-4. 연령 보정
**연령대별 보정값**

| 연령대 | 보정 점수 | 근거 |
|--------|---------|------|
| ~29세 | +0점 | 기준 연령대 |
| 30~39세 | +4점 | 인지 능력 자연 감소 보정 |
| 40~49세 | +8점 | 동일 |
| 50~59세 | +12점 | 동일 |
| 60세 이상 | +16점 | 동일 |

**보정 적용 예시**
- 25세, 기본 88점 → 88 + 0 = 88점
- 35세, 기본 88점 → 88 + 4 = 92점
- 45세, 기본 88점 → 88 + 8 = 96점
- 55세, 기본 88점 → 88 + 12 = 100점 (제한)
- 65세, 기본 96점 → 96 + 16 = 100점 (제한)

### 5-5. 백분위 계산
**점수별 백분위 매핑**

| 종합 점수 |	백분위 |
|--------|---------|
| 95점 이상|	상위 1% |
| 90~94점	| 상위 2% |
| 85~89점	| 상위 5% |
| 75~84점	| 상위 10% |
| 65~74점	| 상위 25% |
| 55~64점	| 상위 50% |
| 45~54점	| 하위 50% |
| 45점 미만	| 하위 75% |
---

## 6. 결제 시스템

### 6-1. 결제 옵션

| 옵션 | 가격 | 포함 내용 |
|------|------|----------|
| **기본 결과** | 19,900원 | IQ 점수 + 백분위 + 발급번호 + 진위확인 코드 |
| **상세 리포트** | 24,900원 | 기본 결과 + 표준편차 그래프 4개 + 단계별 분석 + 개선 방향 |
| **차액 결제** | 5,000원 | 기본 결과 구매 후 상세 리포트 업그레이드 |

### 6-2. 결제 흐름

```
[테스트 완료]
  ↓
[점수 산출 완료]
  ↓
[결제 선택 화면]
  ├─ 기본 결과 선택 → 결제 → 기본 결과 확인
  │                      ↓
  │                   [차액 결제 안내] → 5,000원 추가 결제 → 상세 리포트
  │
  └─ 상세 리포트 선택 → 결제 → 전체 결과 확인
```

### 6-3. 결제 모듈 연동

**PG사: 이니시스**
- 별도 모듈로 개발
- 결제 완료 후 결과 페이지 접근 권한 부여
- 결제 내역 DB 저장 및 관리자 조회 가능

---

## 7. 결과 출력

### 7-1. 기본 결과 포함 항목

**화면 구성**
```
┌────────────────────────────────┐
│        {테스트명} Result        │
├────────────────────────────────┤
│                                │
│        점수: 78           │
│      (큰 폰트, 강조)           │
│                                │
│     상위 25% (백분위)          │
│                                │
├────────────────────────────────┤
│  이름: 홍길동                  │
│  출생연도: 1990년              │
│  발급번호: MS-2026-123456   │
│  진위확인 코드: A3F2-8D1C      │
├────────────────────────────────┤
│  [상세 리포트 보기] 버튼       │
│  (차액 결제 안내)              │
└────────────────────────────────┘
```

**발급번호 생성 규칙**
```javascript
형식: MS-{년도}-{일련번호 6자리}
예시: MS-2026-000123

일련번호 = 응시 로그 ID (자동 증가)
```

**진위확인 코드 생성 규칙**
```javascript
형식: {4자리 해시}-{4자리 해시}
예시: A3F2-8D1C

생성 방법: MD5(이름 + 이메일 + 발급번호 + 타임스탬프).substring(0, 9).toUpperCase()
```

### 7-2. 상세 리포트 추가 항목

**화면 구성**
```
[기본 결과]
  +
[표준편차 그래프 4개] 
  1. 종합 그래프
  2. 1단계 그래프
  3. 2단계 그래프
  4. 3단계 그래프
  +
[단계별 점수 및 백분위]
  +
[개선 방향 제시]
  +
[PDF 다운로드 버튼]
```

### 7-3. 표준편차 그래프 구현

**방식 1: 동적 SVG (권장)**
- Canvas 또는 Chart.js 활용
- 정규분포 곡선 그리고 사용자 위치 동적 표시

**방식 2: 정적 이미지 (차선책)**
- 정규분포 곡선 이미지 10개 준비
- 사용자 백분위에 따라 해당 이미지 표시

**이미지 매핑 예시**
```javascript
상위 1% 이하 → bell-curve-top1.png
상위 2% 이하 → bell-curve-top2.png
상위 5% 이하 → bell-curve-top5.png
상위 10% 이하 → bell-curve-top10.png
상위 25% 이하 → bell-curve-top25.png
상위 50% 이하 → bell-curve-top50.png
하위 50% → bell-curve-below50.png
...
```

### 7-4. 개선 방향 멘트

**점수대별 멘트 예시 (5~10가지 준비)**

```javascript
상위 1% 이내:
"멘사 회원 수준의 뛰어난 지능을 보유하고 계십니다. 공식 멘사 입회 테스트 합격 가능성이 매우 높습니다."

상위 2~5%:
"우수한 인지 능력을 가지고 계십니다. 멘사 공식 테스트에 도전해보시길 권장드립니다."

상위 10~25%:
"평균 이상의 능력을 보유하고 계십니다. 추가 학습과 훈련을 통해 더욱 발전할 수 있습니다."

상위 50%:
"평균 수준의 인지 능력을 가지고 계십니다. 꾸준한 노력으로 향상 가능합니다."

하위 50%:
"아직 발전 가능성이 많습니다. 충분한 휴식 후 재도전을 권장합니다."
```

### 7-5. PDF 다운로드 (상세 리포트만)

**생성 방식**
- jsPDF 라이브러리 활용
- 또는 서버 사이드에서 PDF 생성 (PHP FPDF / Python ReportLab)

**파일명 규칙**
```
{테스트명}_Report_{이름}_{발급번호}.pdf
예시: {테스트명}_Report_홍길동_MS-2026-123456.pdf
```

---

## 8. 결과 재확인 및 이메일 발송

### 8-1. 비회원 결과 재확인 정책

**제한 사항**
- 결제 직후 1회만 결과 확인 가능
- 브라우저 닫거나 이탈 시 재확인 불가 
- 사이트 내 조회 기능 없음 

**대안: 이메일 발송**
- 결제 완료 후 자동으로 이메일 발송
- 기본 결과: 이메일 본문에 점수, 백분위, 발급번호, 진위확인 코드 포함
- 상세 리포트: PDF 파일 첨부 또는 다운로드 링크 제공

### 8-2. 이메일 템플릿

**기본 결과 이메일**
```
제목: [MENSAKOREA] {테스트명} 결과 안내

본문:
안녕하세요, {이름}님.

{테스트명} 를 응시해주셔서 감사합니다.

■ 테스트 결과
 - 점수: 78
 - 백분위: 상위 25%
 - 발급번호: MS-2026-123456
 - 진위확인 코드: A3F2-8D1C

■ 상세 리포트 열람
 차액 5,000원 결제 시 상세 분석 리포트를 확인하실 수 있습니다.
 [상세 리포트 보기] (링크)

감사합니다.
```

**상세 리포트 이메일**
```
제목: [MENSAKOREA] {테스트명} 상세 리포트

본문:
안녕하세요, {이름}님.

상세 리포트가 첨부되어 있습니다.
PDF 파일을 다운로드하여 확인해주세요.

감사합니다.

첨부: {테스트명}_Report_홍길동_MS-2026-123456.pdf
```

---

## 9. 보안 및 부정행위 방지

### 9-1. 비정상 응시 패턴 차단

**차단 조건**
1. 평균 응답 시간 N초 미만
2. 정답률 N% 미만

**차단 시 처리**
- 메시지 표시: "정답률이 너무 낮거나 비정상적인 응시 패턴이 감지되었습니다. 문제를 충분히 읽고 신중히 응답해주세요."
- 해당 단계 처음부터 재응시 제공
- 로그는 저장 (비정상 응시 플래그 추가) → 🔴응시자 정보 등이 유지되어야 해서, 비정상 응시 감지로 재시작되어도 하나로 저장되어야 할 것 같음.

### 9-2. 결과 페이지 직접 접근 차단

**구현 방법**
- 세션 또는 토큰 기반 인증
- 결제 완료 후 임시 토큰 발급
- 토큰 없이 결과 페이지 접근 시 → 메인 페이지로 리다이렉트

---

## 10. 관리자 기능

### 10-1. 문제 관리

**기능 목록**
- 3단계 각 설정 관리 - 단계별 출제 문제 수, 제한 시간 등
- 문제 등록 / 수정 / 삭제
- 단계별 문제 은행 관리

**문제 등록 폼 예시**ㅁ
```
┌─────────────────────────────┐
│ 단계 선택: [1단계 ▼]        │
│                             │
│ 문제 이미지 업로드:          │
│ [파일 선택] problem1.jpg    │
│                             │
│ 보기 개수: [4개 ▼]          │
│                             │
│ 보기 1: [파일 선택] opt1.jpg│
│ 보기 2: [파일 선택] opt2.jpg│
│ 보기 3: [파일 선택] opt3.jpg│
│ 보기 4: [파일 선택] opt4.jpg│
│                             │
│ 정답: ◯ 보기 1              │
│       ◯ 보기 2              │
│       ● 보기 3 (선택됨)     │
│       ◯ 보기 4              │
│                             │
│ [저장] [취소]               │
└─────────────────────────────┘
```

**특이사항**
- 문제와 보기는 텍스트 입력 또는 이미지첨부 또는 텍스트+이미지첨부 가능 : 이미지 첨부시 등록/조회 등 모든 화면에서 썸네일 노출
- 보기 개수 2~8개 유동적 선택 가능
- 8개 미만 선택 시 나머지 보기 입력란 비활성화
- 정답은 라디오 버튼으로 1개만 선택 가능

### 10-2. 응시 로그 관리

**저장 항목**

| 항목 | 설명 |
|------|------|
| 로그 ID | 자동 증가 (PRIMARY KEY) |
| 응시 일시 | 타임스탬프 |
| IP 주소 | 자동 수집 |
| 회원 ID | 로그인 시 저장 |
| 이름 | 사용자 입력 |
| 출생연도 | 사용자 입력 |
| 이메일 | 사용자 입력 |
| 1단계 점수 | 	100점 만점 |
| 2단계 점수 | 	100점 만점 |
| 3단계 점수 | 	100점 만점|
| 총 점수 |  	3단계 평균 |
| 기본 점수 | 연령 보정 전 |
| 최종 점수 | 연령 보정 후 |
| 백분위 | 계산 결과 |
| 문제별 선택답안 | 선택보기파일명 또는 옵션코드 |
| 발급번호 | 생성 결과 |
| 진위확인 코드 | 생성 결과 |
| 결제 여부 | Y / N |
| 결제 금액 | 19,900 / 24,900 / 5,000 |
| 결제 일시 | 타임스탬프 |
| 완료 여부 | 완료 / 미완료 / 중간 이탈 |
| 비정상 패턴 플래그 | Y / N |
| 평균 응답시간 | 초 단위 |

**관리자 조회 화면 예시**
```
┌────────────────────────────────────────────────────────┐
│ 필터:                                                  │
│ 날짜: [2026-01-01] ~ [2026-12-31]                      │
│ 결제 여부: [전체 ▼]                                     │
│ 완료 여부: [전체 ▼]                                     │
│ [검색]                                                 │
├────────────────────────────────────────────────────────┤
│ 로그ID │ 이름 │ 이메일 │ IQ │ 백분위 │ 결제 │ 일시     │
├────────────────────────────────────────────────────────┤
│ 123    │ 홍길동│ hong@  │118 │ 상위25%│ Y   │2026-02-24│
│ 122    │ 김철수│ kim@   │105 │ 상위50%│ N   │2026-02-23│
│ ...                                                    │
└────────────────────────────────────────────────────────┘

[CSV 다운로드]
```

**상세 보기**
- 로그 클릭 시 상세 정보 표시
- 문제별 정답/오답 표시
- 문제별 소요 시간 표시

### 10-3. 결제 내역 조회

**조회 항목**
- 결제 일시
- 이름
- 이메일
- 결제 금액
- 결제 수단 (카드 / 계좌이체 등)
- PG 거래번호

---

## 11. 문의하기 시스템

### 11-1. 변경 사항

**기존 (v1)**
- 로그인 후 문의 가능
- 문의 내역 DB 저장

**변경 요구사항 (v2)**
- **폼메일 방식**으로 변경
- 로그인 불필요
- 문의 양식 작성 → 관리자 이메일로 자동 전송
- 관리자 페이지에서 수신 이메일 변경 가능

**변경 이유**
- 운영 담당자 변경 또는 외부 위탁 대비
- 간편한 관리 및 유지보수

### 11-2. 문의 양식

```
┌─────────────────────────────┐
│ 이름: [텍스트 입력]           │
│ 이메일: [이메일 입력]         │
│ 문의 유형:                   │
│  ◯ 테스트 관련               │
│  ◯ 결제 문의                 │
│  ◯ 기타                     │
│                             │
│ 문의 내용:                   │
│ [────────────────────]      │
│ │                   │       │
│ │                   │       │
│ [────────────────────]      │
│                             │
│ [전송] [취소]                │
└─────────────────────────────┘
```

### 11-3. 이메일 전송

**수신 이메일**
- 관리자 페이지에서 설정 가능
- 기본값: admin@mensa.co.kr

**이메일 제목**
```
[MENSA 문의] {문의 유형} - {이름}
예시: [MENSA 문의] 결제 문의 - 홍길동
```

**이메일 본문**
```
■ 문의자 정보
 - 이름: 홍길동
 - 이메일: hong@example.com
 - 문의 유형: 결제 문의

■ 문의 내용
결제 완료 후 결과를 확인할 수 없습니다.
...

■ 문의 일시
2026-02-24 14:30:25
```

---

## 12. 파일 구조 및 모듈화

### 12-1. 디렉토리 구조

```
mensa-onlineTest-system/
│
├─ index.html
├─ info-form.html
├─ test.html
├─ payment.html
├─ result-basic.html
├─ result-detail.html
├─ contact.html
│
├─ includes/                    # 인클루드 파일 폴더 (신규)
│  ├─ header.html              # 사용자 헤더
│  ├─ footer.html              # 사용자 푸터
│  ├─ admin-header.html        # 관리자 헤더
│  └─ admin-sidebar.html        # 관리자 사이드바
│
├─ admin/
│  ├─ login.html
│  ├─ dashboard.html
│  ├─ test-settings.html       # 테스트 설정 관리 (신규)
│  ├─ question-manage.html
│  ├─ log-list.html
│  └─ settings.html
│
├─ css/
│  ├─ common.css
│  ├─ header-footer.css        # 헤더/푸터 전용 스타일
│  ├─ test.css
│  ├─ result.css
│  └─ admin.css
│
├─ js/
│  ├─ common.js
│  ├─ include-loader.js        # 인클루드 로더
│  ├─ test-engine.js
│  ├─ scoring.js
│  ├─ validation.js
│  ├─ payment.js
│  ├─ email.js
│  └─ admin.js
│
├─ images/
│  ├─ logo.png                 # 로고 (신규)
│  ├─ questions/
│  ├─ options/
│  └─ bell-curves/
│
├─ data/
│  └─ questions.json
│
└─ api/
   ├─ save-log.php
   ├─ get-questions.php
   ├─ get-test-settings.php    # 테스트 설정 조회 (신규)
   ├─ save-test-settings.php   # 테스트 설정 저장 (신규)
   ├─ verify-payment.php
   ├─ send-email.php
   └─ admin-api.php
```

### 12-2. 모듈화 전략

**공통 모듈 (common.js)**
- 로컬스토리지 관리
- 세션 관리
- IP 주소 가져오기
- 타임스탬프 생성
- 랜덤 배열 섞기 (보기 랜덤)

**테스트 엔진 (test-engine.js)**
- 테스트 설정 불러오기 (문제 수, 시간, 배점)
- 문제 불러오기
- 타이머 관리 (1단계 30분)
- 답안 저장
- 다음 문제 이동
- 진행률 표시

**채점 모듈 (scoring.js)**
- 정답 비교
- 단계별 점수 계산 (기본점수 + 정답점수 + 연령보정)
- 종합 점수 계산 (3단계 평균)
- 100점 초과 방지
- 백분위 계산
- 발급번호 생성
- 진위확인 코드 생성

**검증 모듈 (validation.js)**
- 정답률 검증 (설정값 기준)
- 평균 응답시간 검증 (설정값 기준)
- IP 중복 체크
- 비정상 패턴 판단

**인클루드 모듈 (include-loader.js)**
- HTML 파일 동적 로드 (헤더/푸터/사이드바)
- 스크립트 실행 처리
- 현재 페이지 메뉴 하이라이트
- 로드 완료 콜백 처리
- 에러 핸들링 및 로깅
- 다중 인클루드 순차 처리
- 인클루드 캐싱 (선택적)

---
